# æ–°æ¶æ„ç‰ˆæœ¬æ›´æ”¹è®°å½•

ç‰ˆæœ¬ï¼š2.0.0-alpha
æ—¥æœŸï¼š2025-07-20
åˆ†æ”¯ï¼šnew-architecture-version

## ğŸ—ï¸ æ¶æ„é‡æ„

### 1. Clean Architecture å®ç°
- **Domainå±‚** (`lib/core/domain/`)
  - å®ä½“å®šä¹‰ï¼šTransaction, Category, User, JarSettings
  - ä»“åº“æ¥å£ï¼šå®šä¹‰æ•°æ®è®¿é—®å¥‘çº¦
  - æœåŠ¡æ¥å£ï¼šSyncServiceåŒæ­¥æœåŠ¡æ¥å£
  
- **Dataå±‚** (`lib/core/data/`)
  - æ•°æ®æ¨¡å‹ï¼šä¸å®ä½“å¯¹åº”çš„å¯åºåˆ—åŒ–æ¨¡å‹
  - ä»“åº“å®ç°ï¼šå®ç°Domainå±‚å®šä¹‰çš„æ¥å£
  - æ•°æ®æºï¼šLocalDataSourceï¼ˆHiveï¼‰, RemoteDataSourceï¼ˆé¢„ç•™ï¼‰
  
- **Presentationå±‚** (`lib/presentation/`)
  - ProviderçŠ¶æ€ç®¡ç†ï¼šTransactionProvider, CategoryProvider
  - é¡µé¢ç»„ä»¶ï¼šæ‹†åˆ†ä¸ºç‹¬ç«‹çš„åŠŸèƒ½é¡µé¢
  - é€šç”¨ç»„ä»¶ï¼šå¯å¤ç”¨çš„UIç»„ä»¶

### 2. ä¾èµ–æ³¨å…¥ç³»ç»Ÿ
- ä½¿ç”¨ get_it åŒ…ç®¡ç†ä¾èµ–
- ServiceLocator æ¨¡å¼ï¼ˆ`lib/core/di/service_locator.dart`ï¼‰
- æ‰€æœ‰ä¾èµ–åœ¨åº”ç”¨å¯åŠ¨æ—¶æ³¨å†Œ

### 3. å‘åå…¼å®¹æœºåˆ¶
- StorageServiceAdapterï¼šå°†æ–°æ¶æ„é€‚é…ä¸ºæ—§æ¥å£
- æ”¯æŒæ¸è¿›å¼è¿ç§»ï¼Œæ–°æ—§ä»£ç å¯å…±å­˜

## ğŸ“ æ–°å¢æ–‡ä»¶ç»“æ„

```
lib/
â”œâ”€â”€ app/                        # åº”ç”¨é…ç½®
â”‚   â””â”€â”€ app.dart               # ä¸»åº”ç”¨é…ç½®
â”œâ”€â”€ core/                       # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ data/                   # æ•°æ®å±‚
â”‚   â”‚   â”œâ”€â”€ datasources/        # æ•°æ®æº
â”‚   â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ repositories/      # ä»“åº“å®ç°
â”‚   â”œâ”€â”€ di/                    # ä¾èµ–æ³¨å…¥
â”‚   â”œâ”€â”€ domain/                # é¢†åŸŸå±‚
â”‚   â”‚   â”œâ”€â”€ entities/          # ä¸šåŠ¡å®ä½“
â”‚   â”‚   â”œâ”€â”€ repositories/      # ä»“åº“æ¥å£
â”‚   â”‚   â””â”€â”€ services/          # æœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ errors/                # é”™è¯¯å¤„ç†
â”‚   â”œâ”€â”€ routes/                # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ theme/                 # ä¸»é¢˜é…ç½®
â”‚   â””â”€â”€ utils/                 # å·¥å…·ç±»
â”œâ”€â”€ features/                   # åŠŸèƒ½æ¨¡å—ï¼ˆé¢„ç•™ï¼‰
â”œâ”€â”€ presentation/               # è¡¨ç°å±‚
â”‚   â”œâ”€â”€ pages/                 # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ home/             # ä¸»é¡µåŠç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ settings/         # è®¾ç½®é¡µ
â”‚   â”‚   â”œâ”€â”€ splash/           # å¯åŠ¨é¡µ
â”‚   â”‚   â””â”€â”€ statistics/       # ç»Ÿè®¡é¡µ
â”‚   â”œâ”€â”€ providers/            # çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ widgets/              # é€šç”¨ç»„ä»¶
â”œâ”€â”€ shared/                    # å…±äº«èµ„æº
â””â”€â”€ tools/                     # å·¥å…·è„šæœ¬
    â””â”€â”€ migration/            # æ•°æ®è¿ç§»å·¥å…·

bin/
â””â”€â”€ migrate.dart              # å‘½ä»¤è¡Œè¿ç§»å·¥å…·

test/
â””â”€â”€ core/                     # æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
    â”œâ”€â”€ data/                # æ•°æ®å±‚æµ‹è¯•
    â””â”€â”€ domain/              # é¢†åŸŸå±‚æµ‹è¯•
```

## ğŸ”§ ä¸»è¦é‡æ„å†…å®¹

### 1. æ‹†åˆ†å¤§æ–‡ä»¶
- **home_screen.dart** (800è¡Œ) â†’ æ‹†åˆ†ä¸ºï¼š
  - TransactionList ç»„ä»¶
  - QuickStats ç»„ä»¶
  - ActionButtons ç»„ä»¶
  
- **drag_record_input.dart** (1600+è¡Œ) â†’ æ‹†åˆ†ä¸ºï¼š
  - DragRecordController (çŠ¶æ€ç®¡ç†)
  - CategoryPieChart (é¥¼å›¾)
  - DraggableRecordDot (æ‹–åŠ¨å…ƒç´ )
  - NewCategoryDialog (å¯¹è¯æ¡†)

### 2. æ–°å¢åŠŸèƒ½æ¨¡å—
- **æ•°æ®è¿ç§»å·¥å…·**
  - MigrationRunnerï¼šæ‰§è¡Œæ•°æ®è¿ç§»
  - MigrationValidatorï¼šéªŒè¯è¿ç§»ç»“æœ
  - MigrationCheckerï¼šæ£€æŸ¥è¿ç§»çŠ¶æ€
  
- **ç»Ÿè®¡é¡µé¢ç»„ä»¶**
  - PeriodSelectorï¼šæ—¶é—´é€‰æ‹©å™¨
  - StatisticsCardï¼šç»Ÿè®¡å¡ç‰‡
  - CategoryPieChartï¼šåˆ†ç±»é¥¼å›¾
  - MonthlyBarChartï¼šæœˆåº¦æŸ±çŠ¶å›¾
  - TrendLineChartï¼šè¶‹åŠ¿æŠ˜çº¿å›¾

### 3. æ”¹è¿›çš„æ•°æ®æ¨¡å‹
- Transactionå®ä½“æ–°å¢å­—æ®µï¼š
  - tags: æ ‡ç­¾åˆ—è¡¨
  - attachments: é™„ä»¶åˆ—è¡¨
  - notes: å¤‡æ³¨ä¿¡æ¯
  - location: åœ°ç†ä½ç½®
  - syncedAt: åŒæ­¥æ—¶é—´
  
- Categoryå®ä½“æ”¹è¿›ï¼š
  - æ”¯æŒçˆ¶å­åˆ†ç±»å…³ç³»
  - æ·»åŠ ä½¿ç”¨æ¬¡æ•°ç»Ÿè®¡
  - æ”¯æŒç¦ç”¨çŠ¶æ€

## ğŸš€ æ–°ç‰¹æ€§

1. **æ¨¡å—åŒ–æ¶æ„**ï¼šæ¸…æ™°çš„åˆ†å±‚ï¼Œä¾¿äºç»´æŠ¤å’Œæµ‹è¯•
2. **ä¾èµ–æ³¨å…¥**ï¼šè§£è€¦ç»„ä»¶ä¾èµ–ï¼Œæé«˜å¯æµ‹è¯•æ€§
3. **æ•°æ®è¿ç§»**ï¼šå¹³æ»‘å‡çº§æ•°æ®ç»“æ„
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šä»“åº“å±‚ç¼“å­˜æœºåˆ¶
5. **æ‰©å±•æ€§**ï¼šé¢„ç•™å¤šç”¨æˆ·ã€äº‘åŒæ­¥æ¥å£

## ğŸ”„ è¿ç§»æŒ‡å—

### ä½¿ç”¨æ–°æ¶æ„
```bash
# æ–¹å¼1ï¼šä¿®æ”¹å…¥å£æ–‡ä»¶
flutter run -t lib/main_new.dart

# æ–¹å¼2ï¼šä¿®æ”¹ main.dart å¯¼å…¥ main_new.dart
```

### æ•°æ®è¿ç§»
```bash
# æ£€æŸ¥è¿ç§»çŠ¶æ€
dart run bin/migrate.dart check

# æ‰§è¡Œè¿ç§»
dart run bin/migrate.dart run

# éªŒè¯ç»“æœ
dart run bin/migrate.dart validate
```

## âš ï¸ ç ´åæ€§æ›´æ”¹

1. æ•°æ®æ¨¡å‹ç»“æ„å˜åŒ–ï¼ˆå·²æä¾›è¿ç§»å·¥å…·ï¼‰
2. Provideræ¥å£å˜åŒ–ï¼ˆéœ€è¦æ›´æ–°ä¾èµ–çš„UIä»£ç ï¼‰
3. æ–‡ä»¶è·¯å¾„å˜åŒ–ï¼ˆimportè¯­å¥éœ€è¦æ›´æ–°ï¼‰

## ğŸ“ åç»­è®¡åˆ’

- [ ] å®Œæˆäº¤æ˜“è¾“å…¥é¡µé¢æ–°æ¶æ„ç‰ˆæœ¬
- [ ] é›†æˆæ‹–åŠ¨è¾“å…¥ç»„ä»¶åˆ°æ–°æ¶æ„
- [ ] å®ç°æ•°æ®å¯¼å‡ºåŠŸèƒ½
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•è¦†ç›–
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜ç­–ç•¥
- [ ] å¤šè¯­è¨€æ”¯æŒ