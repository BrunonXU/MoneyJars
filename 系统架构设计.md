# MoneyJars v2.0 ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ä¿¡æ¯
- **é¡¹ç›®åç§°**: MoneyJars v2.0
- **æ¶æ„ç‰ˆæœ¬**: 2.0.0
- **æ›´æ–°æ—¥æœŸ**: 2025-01-20
- **æ¶æ„æ¨¡å¼**: Clean Architecture + Repository Pattern + Provider

### 1.2 æ ¸å¿ƒåŠŸèƒ½
1. **æ‹–æ‹½å¼è®°è´¦**: åˆ›æ–°çš„æ‰‹åŠ¿äº¤äº’è®°è´¦æ–¹å¼
2. **åˆ†ç±»ç®¡ç†**: æ”¯æŒå¤šçº§åˆ†ç±»å’Œè‡ªå®šä¹‰ç±»åˆ«
3. **æ•°æ®å¯è§†åŒ–**: é¥¼å›¾ã€è¶‹åŠ¿å›¾ç­‰å¤šç»´åº¦æ•°æ®å±•ç¤º
4. **æ•°æ®æŒä¹…åŒ–**: æœ¬åœ°å­˜å‚¨å’Œäº‘åŒæ­¥æ”¯æŒ
5. **ä¸»é¢˜ç³»ç»Ÿ**: æ·±è‰²/æµ…è‰²ä¸»é¢˜åˆ‡æ¢
6. **æ•°æ®è¿ç§»**: æ–°æ—§æ¶æ„æ•°æ®æ— ç¼è¿ç§»

### 1.3 æŠ€æœ¯æ ˆ
```yaml
å‰ç«¯æ¡†æ¶: Flutter 3.x
çŠ¶æ€ç®¡ç†: Provider 6.x
ä¾èµ–æ³¨å…¥: get_it 7.x
æœ¬åœ°å­˜å‚¨: Hive 2.x
ç½‘ç»œè¯·æ±‚: Dio 5.x
å›¾è¡¨åº“: fl_chart 0.x
åŠ¨ç”»æ¡†æ¶: Flutter Animations
æ‰‹åŠ¿è¯†åˆ«: GestureDetector
```

## 2. æ¶æ„è®¾è®¡åŸåˆ™

### 2.1 Clean Architecture åŸåˆ™
- **ç‹¬ç«‹æ€§**: ä¸šåŠ¡é€»è¾‘ç‹¬ç«‹äºUIã€æ•°æ®åº“å’Œå¤–éƒ¨æ¡†æ¶
- **å¯æµ‹è¯•æ€§**: ä¸šåŠ¡è§„åˆ™å¯ä»¥åœ¨æ²¡æœ‰UIã€æ•°æ®åº“çš„æƒ…å†µä¸‹æµ‹è¯•
- **UIç‹¬ç«‹æ€§**: UIå¯ä»¥è½»æ¾æ›´æ”¹ï¼Œä¸å½±å“ç³»ç»Ÿå…¶ä½™éƒ¨åˆ†
- **æ•°æ®åº“ç‹¬ç«‹æ€§**: å¯ä»¥è½»æ¾åˆ‡æ¢æ•°æ®åº“å®ç°

### 2.2 è®¾è®¡æ¨¡å¼
- **Repository Pattern**: æ•°æ®è®¿é—®æŠ½è±¡
- **Use Cases**: ä¸šåŠ¡é€»è¾‘å°è£…
- **Dependency Injection**: ä¾èµ–æ³¨å…¥å®ç°è§£è€¦
- **Provider Pattern**: çŠ¶æ€ç®¡ç†
- **Factory Pattern**: æ¨¡å‹åˆ›å»º

## 3. ç›®å½•ç»“æ„

### 3.1 å®Œæ•´ç›®å½•æ ‘
```
lib/
â”œâ”€â”€ main.dart                      # æ—§ç‰ˆæœ¬å…¥å£ï¼ˆä¿ç•™å…¼å®¹ï¼‰
â”œâ”€â”€ main_new.dart                  # æ–°æ¶æ„å…¥å£
â”œâ”€â”€ app/                          # åº”ç”¨é…ç½®å±‚
â”‚   â””â”€â”€ app.dart                  # åº”ç”¨ä¸»ç»„ä»¶
â”œâ”€â”€ core/                         # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ domain/                   # é¢†åŸŸå±‚
â”‚   â”‚   â”œâ”€â”€ entities/             # ä¸šåŠ¡å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ category.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ subcategory.dart
â”‚   â”‚   â”‚   â””â”€â”€ transaction.dart
â”‚   â”‚   â”œâ”€â”€ repositories/         # ä»“åº“æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ category_repository.dart
â”‚   â”‚   â”‚   â””â”€â”€ transaction_repository.dart
â”‚   â”‚   â””â”€â”€ usecases/            # ç”¨ä¾‹
â”‚   â”‚       â”œâ”€â”€ category/
â”‚   â”‚       â”‚   â”œâ”€â”€ add_category.dart
â”‚   â”‚       â”‚   â”œâ”€â”€ delete_category.dart
â”‚   â”‚       â”‚   â”œâ”€â”€ get_categories.dart
â”‚   â”‚       â”‚   â””â”€â”€ update_category.dart
â”‚   â”‚       â””â”€â”€ transaction/
â”‚   â”‚           â”œâ”€â”€ add_transaction.dart
â”‚   â”‚           â”œâ”€â”€ delete_transaction.dart
â”‚   â”‚           â”œâ”€â”€ get_transactions.dart
â”‚   â”‚           â””â”€â”€ update_transaction.dart
â”‚   â”œâ”€â”€ data/                    # æ•°æ®å±‚
â”‚   â”‚   â”œâ”€â”€ datasources/         # æ•°æ®æº
â”‚   â”‚   â”‚   â”œâ”€â”€ local/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ hive_datasource.dart
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ default_categories.dart
â”‚   â”‚   â”‚   â””â”€â”€ remote/
â”‚   â”‚   â”‚       â””â”€â”€ api_datasource.dart
â”‚   â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ category_model.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ category_model.g.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ subcategory_model.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ subcategory_model.g.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ transaction_model.dart
â”‚   â”‚   â”‚   â””â”€â”€ transaction_model.g.dart
â”‚   â”‚   â””â”€â”€ repositories/        # ä»“åº“å®ç°
â”‚   â”‚       â”œâ”€â”€ category_repository_impl.dart
â”‚   â”‚       â””â”€â”€ transaction_repository_impl.dart
â”‚   â””â”€â”€ di/                      # ä¾èµ–æ³¨å…¥
â”‚       â””â”€â”€ injection_container.dart
â”œâ”€â”€ presentation/                # è¡¨ç°å±‚
â”‚   â”œâ”€â”€ pages/                   # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ home/
â”‚   â”‚   â”‚   â”œâ”€â”€ home_page_new.dart
â”‚   â”‚   â”‚   â””â”€â”€ widgets/
â”‚   â”‚   â”‚       â”œâ”€â”€ action_buttons.dart
â”‚   â”‚   â”‚       â”œâ”€â”€ category_card.dart
â”‚   â”‚   â”‚       â””â”€â”€ transaction_list.dart
â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â”œâ”€â”€ settings_page_new.dart
â”‚   â”‚   â”‚   â””â”€â”€ migration_page.dart
â”‚   â”‚   â””â”€â”€ statistics/
â”‚   â”‚       â””â”€â”€ statistics_page.dart
â”‚   â”œâ”€â”€ providers/               # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ category_provider.dart
â”‚   â”‚   â”œâ”€â”€ transaction_provider.dart
â”‚   â”‚   â””â”€â”€ theme_provider.dart
â”‚   â””â”€â”€ widgets/                 # å…±äº«ç»„ä»¶
â”‚       â”œâ”€â”€ common/
â”‚       â”‚   â”œâ”€â”€ loading_widget.dart
â”‚       â”‚   â””â”€â”€ error_widget.dart
â”‚       â””â”€â”€ input/
â”‚           â”œâ”€â”€ drag_input/
â”‚           â”‚   â”œâ”€â”€ drag_record_input_new.dart
â”‚           â”‚   â”œâ”€â”€ draggable_record_dot.dart
â”‚           â”‚   â”œâ”€â”€ category_pie_chart.dart
â”‚           â”‚   â””â”€â”€ new_category_dialog.dart
â”‚           â””â”€â”€ quick_amount_input.dart
â”œâ”€â”€ services/                    # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ storage_service.dart
â”‚   â”œâ”€â”€ storage_service_web.dart
â”‚   â””â”€â”€ theme_service.dart
â””â”€â”€ tools/                       # å·¥å…·
    â””â”€â”€ migration/
        â””â”€â”€ data_migration_tool.dart
```

## 4. æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 4.1 é¢†åŸŸå±‚ (Domain Layer)

#### 4.1.1 å®ä½“å®šä¹‰
```dart
// category.dart
class Category {
  final String id;
  final String name;
  final String icon;
  final int color;
  final CategoryType type;
  final double currentAmount;
  final double targetAmount;
  final DateTime createdAt;
  final DateTime updatedAt;
  final List<SubCategory> subCategories;
}

// transaction.dart
class Transaction {
  final String id;
  final String categoryId;
  final String? subCategoryId;
  final double amount;
  final String? note;
  final DateTime date;
  final TransactionType type;
}
```

#### 4.1.2 ç”¨ä¾‹å®ç°
```dart
// add_transaction.dart
class AddTransaction {
  final TransactionRepository repository;
  
  AddTransaction(this.repository);
  
  Future<Either<Failure, Transaction>> call(TransactionParams params) async {
    return await repository.addTransaction(params.toEntity());
  }
}
```

### 4.2 æ•°æ®å±‚ (Data Layer)

#### 4.2.1 Hiveæ•°æ®æºå®ç°
```dart
class HiveDataSource implements LocalDataSource {
  static const String categoryBoxName = 'categories';
  static const String transactionBoxName = 'transactions';
  
  Future<void> init() async {
    Hive.registerAdapter(CategoryModelAdapter());
    Hive.registerAdapter(TransactionModelAdapter());
    await Hive.openBox<CategoryModel>(categoryBoxName);
    await Hive.openBox<TransactionModel>(transactionBoxName);
  }
  
  @override
  Future<List<CategoryModel>> getCategories() async {
    final box = Hive.box<CategoryModel>(categoryBoxName);
    return box.values.toList();
  }
}
```

#### 4.2.2 ä»“åº“å®ç°
```dart
class CategoryRepositoryImpl implements CategoryRepository {
  final LocalDataSource localDataSource;
  final RemoteDataSource? remoteDataSource;
  
  @override
  Future<Either<Failure, List<Category>>> getCategories() async {
    try {
      final models = await localDataSource.getCategories();
      return Right(models.map((m) => m.toEntity()).toList());
    } catch (e) {
      return Left(CacheFailure());
    }
  }
}
```

### 4.3 è¡¨ç°å±‚ (Presentation Layer)

#### 4.3.1 ProviderçŠ¶æ€ç®¡ç†
```dart
class CategoryProvider extends ChangeNotifier {
  final GetCategories getCategoriesUseCase;
  final AddCategory addCategoryUseCase;
  
  List<Category> _categories = [];
  bool _isLoading = false;
  
  List<Category> get categories => _categories;
  bool get isLoading => _isLoading;
  
  Future<void> loadCategories() async {
    _isLoading = true;
    notifyListeners();
    
    final result = await getCategoriesUseCase();
    result.fold(
      (failure) => _handleError(failure),
      (categories) {
        _categories = categories;
        _isLoading = false;
        notifyListeners();
      },
    );
  }
}
```

#### 4.3.2 æ‹–æ‹½è¾“å…¥ç»„ä»¶å®ç°
```dart
class DragRecordInputNew extends StatefulWidget {
  @override
  _DragRecordInputNewState createState() => _DragRecordInputNewState();
}

class _DragRecordInputNewState extends State<DragRecordInputNew> 
    with TickerProviderStateMixin {
  late AnimationController _scaleController;
  late AnimationController _fadeController;
  Offset _dragPosition = Offset.zero;
  Category? _selectedCategory;
  
  @override
  void initState() {
    super.initState();
    _scaleController = AnimationController(
      duration: Duration(milliseconds: 200),
      vsync: this,
    );
    _fadeController = AnimationController(
      duration: Duration(milliseconds: 300),
      vsync: this,
    );
  }
  
  void _handleDragUpdate(DragUpdateDetails details) {
    setState(() {
      _dragPosition = details.localPosition;
      _checkCategorySelection();
    });
  }
  
  void _checkCategorySelection() {
    // è®¡ç®—å½“å‰æ‹–æ‹½ä½ç½®å¯¹åº”çš„åˆ†ç±»
    final angle = atan2(_dragPosition.dy - center.dy, 
                       _dragPosition.dx - center.dx);
    final categoryIndex = _calculateCategoryIndex(angle);
    _selectedCategory = categories[categoryIndex];
  }
}
```

## 5. æ•°æ®æµæ¶æ„

### 5.1 å•å‘æ•°æ®æµ
```
UIå±‚ â†’ Provider â†’ Use Case â†’ Repository â†’ Data Source
     â†           â†          â†            â†
```

### 5.2 çŠ¶æ€ç®¡ç†æµç¨‹
1. UIè§¦å‘äº‹ä»¶ï¼ˆå¦‚æ·»åŠ äº¤æ˜“ï¼‰
2. Provideræ¥æ”¶äº‹ä»¶ï¼Œè°ƒç”¨å¯¹åº”Use Case
3. Use Caseæ‰§è¡Œä¸šåŠ¡é€»è¾‘
4. Repositoryåè°ƒæ•°æ®æº
5. Data Sourceæ‰§è¡Œå®é™…æ•°æ®æ“ä½œ
6. ç»“æœé€å±‚è¿”å›ï¼ŒProvideræ›´æ–°çŠ¶æ€
7. UIå“åº”çŠ¶æ€å˜åŒ–ï¼Œæ›´æ–°ç•Œé¢

## 6. å…³é”®æŠ€æœ¯å®ç°

### 6.1 æ‹–æ‹½æ‰‹åŠ¿è¯†åˆ«
```dart
class DragGestureRecognizer {
  static const double minDragDistance = 50.0;
  static const double categorySelectionRadius = 100.0;
  
  Category? detectCategory(Offset position, List<Category> categories) {
    final angle = atan2(position.dy, position.dx);
    final normalizedAngle = (angle + pi) / (2 * pi);
    final index = (normalizedAngle * categories.length).floor();
    return categories[index % categories.length];
  }
  
  bool isValidDrag(Offset start, Offset end) {
    final distance = (end - start).distance;
    return distance >= minDragDistance;
  }
}
```

### 6.2 åŠ¨ç”»ç³»ç»Ÿ
```dart
class AnimationManager {
  // æ‹–æ‹½ç‚¹åŠ¨ç”»
  Animation<double> createDragAnimation(AnimationController controller) {
    return Tween<double>(
      begin: 1.0,
      end: 1.2,
    ).animate(CurvedAnimation(
      parent: controller,
      curve: Curves.easeInOut,
    ));
  }
  
  // åˆ†ç±»é€‰ä¸­åŠ¨ç”»
  Animation<double> createSelectionAnimation(AnimationController controller) {
    return Tween<double>(
      begin: 0.0,
      end: 1.0,
    ).animate(CurvedAnimation(
      parent: controller,
      curve: Curves.elasticOut,
    ));
  }
}
```

### 6.3 æ•°æ®æŒä¹…åŒ–
```dart
class PersistenceManager {
  static Future<void> saveTransaction(Transaction transaction) async {
    final box = Hive.box<TransactionModel>('transactions');
    await box.put(transaction.id, TransactionModel.fromEntity(transaction));
  }
  
  static Future<void> backupData() async {
    final categories = Hive.box<CategoryModel>('categories');
    final transactions = Hive.box<TransactionModel>('transactions');
    
    final backup = {
      'categories': categories.values.map((c) => c.toJson()).toList(),
      'transactions': transactions.values.map((t) => t.toJson()).toList(),
      'timestamp': DateTime.now().toIso8601String(),
    };
    
    // ä¿å­˜åˆ°æ–‡ä»¶æˆ–äº‘ç«¯
  }
}
```

### 6.4 ä¾èµ–æ³¨å…¥é…ç½®
```dart
final getIt = GetIt.instance;

Future<void> configureDependencies() async {
  // æ•°æ®æº
  getIt.registerLazySingleton<LocalDataSource>(
    () => HiveDataSource(),
  );
  
  // ä»“åº“
  getIt.registerLazySingleton<CategoryRepository>(
    () => CategoryRepositoryImpl(
      localDataSource: getIt(),
    ),
  );
  
  // ç”¨ä¾‹
  getIt.registerLazySingleton(() => GetCategories(getIt()));
  getIt.registerLazySingleton(() => AddCategory(getIt()));
  
  // Provider
  getIt.registerFactory(
    () => CategoryProvider(
      getCategoriesUseCase: getIt(),
      addCategoryUseCase: getIt(),
    ),
  );
}
```

## 7. APIè®¾è®¡

### 7.1 å†…éƒ¨APIæ¥å£
```dart
// åˆ†ç±»ç®¡ç†
abstract class CategoryAPI {
  Future<List<Category>> getCategories();
  Future<Category> addCategory(Category category);
  Future<void> updateCategory(String id, Category category);
  Future<void> deleteCategory(String id);
}

// äº¤æ˜“ç®¡ç†
abstract class TransactionAPI {
  Future<List<Transaction>> getTransactions({
    DateTime? startDate,
    DateTime? endDate,
    String? categoryId,
  });
  Future<Transaction> addTransaction(Transaction transaction);
  Future<void> updateTransaction(String id, Transaction transaction);
  Future<void> deleteTransaction(String id);
  Future<TransactionStats> getStatistics(DateRange range);
}
```

### 7.2 RESTful APIï¼ˆé¢„ç•™ï¼‰
```yaml
endpoints:
  categories:
    - GET /api/v1/categories
    - POST /api/v1/categories
    - PUT /api/v1/categories/{id}
    - DELETE /api/v1/categories/{id}
  
  transactions:
    - GET /api/v1/transactions
    - POST /api/v1/transactions
    - PUT /api/v1/transactions/{id}
    - DELETE /api/v1/transactions/{id}
    - GET /api/v1/transactions/stats
```

## 8. æ•°æ®åº“è®¾è®¡

### 8.1 Hiveæ•°æ®æ¨¡å‹
```dart
@HiveType(typeId: 0)
class CategoryModel extends HiveObject {
  @HiveField(0)
  String id;
  
  @HiveField(1)
  String name;
  
  @HiveField(2)
  String icon;
  
  @HiveField(3)
  int color;
  
  @HiveField(4)
  int type; // 0: expense, 1: income
  
  @HiveField(5)
  double currentAmount;
  
  @HiveField(6)
  double targetAmount;
  
  @HiveField(7)
  DateTime createdAt;
  
  @HiveField(8)
  DateTime updatedAt;
  
  @HiveField(9)
  List<SubCategoryModel> subCategories;
}

@HiveType(typeId: 1)
class TransactionModel extends HiveObject {
  @HiveField(0)
  String id;
  
  @HiveField(1)
  String categoryId;
  
  @HiveField(2)
  String? subCategoryId;
  
  @HiveField(3)
  double amount;
  
  @HiveField(4)
  String? note;
  
  @HiveField(5)
  DateTime date;
  
  @HiveField(6)
  int type; // 0: expense, 1: income
}
```

### 8.2 ç´¢å¼•è®¾è®¡
- categories: æŒ‰typeç´¢å¼•ï¼ŒæŒ‰createdAtæ’åº
- transactions: æŒ‰dateç´¢å¼•ï¼ŒæŒ‰categoryIdç´¢å¼•ï¼Œå¤åˆç´¢å¼•(date, categoryId)

## 9. UI/UXæ¶æ„

### 9.1 è®¾è®¡ç³»ç»Ÿ
```dart
class AppTheme {
  static ThemeData lightTheme = ThemeData(
    primarySwatch: Colors.blue,
    scaffoldBackgroundColor: Color(0xFFF5F5F5),
    cardTheme: CardTheme(
      elevation: 2,
      shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.circular(12),
      ),
    ),
  );
  
  static ThemeData darkTheme = ThemeData(
    brightness: Brightness.dark,
    primarySwatch: Colors.blue,
    scaffoldBackgroundColor: Color(0xFF121212),
  );
}
```

### 9.2 ç»„ä»¶åº“
- **åŸºç¡€ç»„ä»¶**: Button, Card, Input, Dialog
- **ä¸šåŠ¡ç»„ä»¶**: CategoryCard, TransactionItem, StatChart
- **å¸ƒå±€ç»„ä»¶**: ResponsiveLayout, GridView, ListView

### 9.3 åŠ¨ç”»è§„èŒƒ
```dart
class AnimationConstants {
  static const Duration short = Duration(milliseconds: 200);
  static const Duration medium = Duration(milliseconds: 300);
  static const Duration long = Duration(milliseconds: 500);
  
  static const Curve defaultCurve = Curves.easeInOut;
  static const Curve bounceCurve = Curves.elasticOut;
}
```

## 10. æµ‹è¯•ç­–ç•¥

### 10.1 å•å…ƒæµ‹è¯•
```dart
// ç”¨ä¾‹æµ‹è¯•
test('AddCategory should add category successfully', () async {
  final mockRepo = MockCategoryRepository();
  final useCase = AddCategory(mockRepo);
  
  when(mockRepo.addCategory(any))
    .thenAnswer((_) async => Right(testCategory));
  
  final result = await useCase(AddCategoryParams(
    name: 'Food',
    icon: 'ğŸ”',
    color: Colors.orange.value,
  ));
  
  expect(result, Right(testCategory));
  verify(mockRepo.addCategory(any));
});
```

### 10.2 Widgetæµ‹è¯•
```dart
testWidgets('DragRecordInput should detect category', (tester) async {
  await tester.pumpWidget(
    MaterialApp(
      home: DragRecordInputNew(),
    ),
  );
  
  await tester.drag(
    find.byType(DraggableRecordDot),
    Offset(100, 0),
  );
  
  expect(find.text('Food'), findsOneWidget);
});
```

### 10.3 é›†æˆæµ‹è¯•
```dart
testWidgets('Complete transaction flow', (tester) async {
  app.main();
  await tester.pumpAndSettle();
  
  // æ‹–æ‹½æ·»åŠ äº¤æ˜“
  await tester.drag(find.byType(DraggableRecordDot), Offset(100, 0));
  await tester.enterText(find.byType(TextField), '50.0');
  await tester.tap(find.text('ç¡®è®¤'));
  await tester.pumpAndSettle();
  
  // éªŒè¯äº¤æ˜“å·²æ·»åŠ 
  expect(find.text('Â¥50.00'), findsOneWidget);
});
```

## 11. éƒ¨ç½²æ¶æ„

### 11.1 æ„å»ºé…ç½®
```yaml
flutter:
  assets:
    - assets/icons/
    - assets/images/
  
  fonts:
    - family: Roboto
      fonts:
        - asset: fonts/Roboto-Regular.ttf
        - asset: fonts/Roboto-Bold.ttf
          weight: 700
```

### 11.2 å¹³å°ç‰¹å®šé…ç½®
- **Android**: minSdkVersion 21, targetSdkVersion 33
- **iOS**: iOS 11.0+
- **Web**: æ”¯æŒPWAï¼ŒService Workerç¼“å­˜

### 11.3 å‘å¸ƒæµç¨‹
1. ç‰ˆæœ¬å·æ›´æ–°
2. ä»£ç æ··æ·†é…ç½®
3. ç­¾åé…ç½®
4. å¤šæ¸ é“æ‰“åŒ…
5. è‡ªåŠ¨åŒ–éƒ¨ç½²

## 12. æ€§èƒ½ä¼˜åŒ–

### 12.1 å¯åŠ¨ä¼˜åŒ–
- æ‡’åŠ è½½éå…³é”®æ¨¡å—
- é¢„åŠ è½½å¸¸ç”¨æ•°æ®
- å¯åŠ¨é¡µä¼˜åŒ–
- é¦–å±æ¸²æŸ“ä¼˜åŒ–

### 12.2 è¿è¡Œæ—¶ä¼˜åŒ–
```dart
// åˆ—è¡¨ä¼˜åŒ–
ListView.builder(
  itemBuilder: (context, index) {
    return TransactionItem(
      key: ValueKey(transactions[index].id),
      transaction: transactions[index],
    );
  },
  itemCount: transactions.length,
  cacheExtent: 1000, // ç¼“å­˜åŒºåŸŸ
);

// å›¾ç‰‡ä¼˜åŒ–
CachedNetworkImage(
  imageUrl: imageUrl,
  placeholder: (context, url) => CircularProgressIndicator(),
  errorWidget: (context, url, error) => Icon(Icons.error),
);
```

### 12.3 å†…å­˜ä¼˜åŒ–
- åŠæ—¶é‡Šæ”¾ä¸ç”¨çš„èµ„æº
- ä½¿ç”¨constæ„é€ å‡½æ•°
- é¿å…å†…å­˜æ³„æ¼
- å›¾ç‰‡ç¼“å­˜ç®¡ç†

## 13. å®‰å…¨è®¾è®¡

### 13.1 æ•°æ®åŠ å¯†
```dart
class EncryptionService {
  static Future<String> encrypt(String plainText) async {
    final key = await _getEncryptionKey();
    final encrypter = Encrypter(AES(key));
    final encrypted = encrypter.encrypt(plainText, iv: _iv);
    return encrypted.base64;
  }
  
  static Future<String> decrypt(String encryptedText) async {
    final key = await _getEncryptionKey();
    final encrypter = Encrypter(AES(key));
    final decrypted = encrypter.decrypt64(encryptedText, iv: _iv);
    return decrypted;
  }
}
```

### 13.2 ç”Ÿç‰©è¯†åˆ«
```dart
class BiometricAuth {
  static Future<bool> authenticate() async {
    final LocalAuthentication auth = LocalAuthentication();
    
    final bool canCheckBiometrics = await auth.canCheckBiometrics;
    if (!canCheckBiometrics) return false;
    
    final bool didAuthenticate = await auth.authenticate(
      localizedReason: 'è¯·éªŒè¯èº«ä»½ä»¥è®¿é—®MoneyJars',
      options: AuthenticationOptions(
        biometricOnly: true,
        stickyAuth: true,
      ),
    );
    
    return didAuthenticate;
  }
}
```

## 14. è¿ç§»æŒ‡å—

### 14.1 æ•°æ®è¿ç§»æ­¥éª¤
1. **å¤‡ä»½æ—§æ•°æ®**
   ```dart
   await DataMigrationTool.backupOldData();
   ```

2. **è½¬æ¢æ•°æ®æ ¼å¼**
   ```dart
   final oldData = await DataMigrationTool.readOldData();
   final newData = DataMigrationTool.convertToNewFormat(oldData);
   ```

3. **å¯¼å…¥æ–°ç³»ç»Ÿ**
   ```dart
   await DataMigrationTool.importToNewSystem(newData);
   ```

4. **éªŒè¯æ•°æ®å®Œæ•´æ€§**
   ```dart
   final isValid = await DataMigrationTool.validateMigration();
   ```

### 14.2 ä»£ç è¿ç§»æ£€æŸ¥æ¸…å•
- [ ] æ‰€æœ‰Providerå·²è¿ç§»åˆ°æ–°æ¶æ„
- [ ] æ—§çš„ç›´æ¥æ•°æ®è®¿é—®å·²æ›¿æ¢ä¸ºRepository
- [ ] UIç»„ä»¶å·²æ›´æ–°ä½¿ç”¨æ–°çš„Provider
- [ ] æµ‹è¯•ç”¨ä¾‹å·²æ›´æ–°
- [ ] æ–‡æ¡£å·²æ›´æ–°

## 15. ç‰ˆæœ¬å†å²

### v2.0.0 (2025-01-20)
- å®Œå…¨é‡æ„ä¸ºClean Architecture
- æ–°å¢æ‹–æ‹½å¼è®°è´¦åŠŸèƒ½
- ä¼˜åŒ–æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ
- æ”¯æŒæ·±è‰²æ¨¡å¼
- æ•°æ®è¿ç§»å·¥å…·

### v1.0.0 (2024-XX-XX)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- åŸºç¡€è®°è´¦åŠŸèƒ½
- åˆ†ç±»ç®¡ç†
- æ•°æ®ç»Ÿè®¡

## 16. å¾…åŠäº‹é¡¹

### é«˜ä¼˜å…ˆçº§
- [ ] å®ŒæˆUIè¿ç§»åˆ°ç”Ÿäº§ç¯å¢ƒ
- [ ] å®ç°äº‘åŒæ­¥åŠŸèƒ½
- [ ] æ·»åŠ æ•°æ®å¯¼å‡ºåŠŸèƒ½
- [ ] æ€§èƒ½ç›‘æ§é›†æˆ

### ä¸­ä¼˜å…ˆçº§
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] é¢„ç®—æé†’åŠŸèƒ½
- [ ] è‡ªå®šä¹‰æŠ¥è¡¨
- [ ] ç¤¾äº¤åˆ†äº«åŠŸèƒ½

### ä½ä¼˜å…ˆçº§
- [ ] AIæ™ºèƒ½åˆ†ç±»
- [ ] è¯­éŸ³è¾“å…¥
- [ ] å°ç»„ä»¶æ”¯æŒ
- [ ] Apple Watchåº”ç”¨

---

**æ–‡æ¡£ç»´æŠ¤è¯´æ˜**: æœ¬æ–‡æ¡£åº”éšç€é¡¹ç›®å‘å±•æŒç»­æ›´æ–°ï¼Œæ¯æ¬¡é‡å¤§æ¶æ„å˜æ›´éƒ½åº”åœ¨æ­¤è®°å½•ã€‚